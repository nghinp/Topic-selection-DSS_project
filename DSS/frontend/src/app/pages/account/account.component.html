<div class="page">
  <app-navbar></app-navbar>

  <main class="content card account">
    <div *ngIf="loading" class="muted">Loading...</div>
    <div *ngIf="error && !loading" class="alert">{{ error }}</div>

    <section *ngIf="!loading" class="account-grid">
      <article class="card-section">
        <header><h3>Saved results</h3></header>
        <div *ngIf="!submissions.length" class="muted">No results yet.</div>
        <ul class="list" *ngIf="submissions.length">
          <li *ngFor="let s of submissions">
            <div>
              <strong>{{ s.thesisType }}</strong>
              <span class="muted" *ngIf="s.createdAt"> · {{ s.createdAt | date:'short' }}</span>
            </div>
            <div class="pill">Top: {{ s.topAreas?.join(', ') || 'N/A' }}</div>
            <a class="btn ghost small" [routerLink]="['/result', s.id]">View</a>
          </li>
        </ul>
      </article>

      <article class="card-section">
        <header><h3>Saved topics</h3></header>
        <div *ngIf="!savedTopics.length" class="muted">No topics saved.</div>
        <ul class="list" *ngIf="savedTopics.length">
          <li *ngFor="let t of savedTopics">
            <div
              class="saved-row"
              [class.clickable]="true"
              (click)="openTopic(t)"
            >
              <ng-container *ngIf="isUuid(t.topic); else noLink">
                <a class="link" [routerLink]="['/topics', t.topic]"><strong>{{ displayTitle(t) }}</strong></a>
              </ng-container>
              <ng-template #noLink><strong>{{ displayTitle(t) }}</strong></ng-template>
              <span class="muted" *ngIf="displayArea(t)"> · {{ displayArea(t) }}</span>
              <span class="muted" *ngIf="t.createdAt"> · {{ t.createdAt | date:'short' }}</span>
              <button
                class="btn ghost small"
                type="button"
                (click)="removeSaved(t.id); $event.stopPropagation()"
                [disabled]="deleting[t.id]"
              >
                {{ deleting[t.id] ? 'Deleting...' : 'Delete' }}
              </button>
            </div>
          </li>
        </ul>
      </article>
    </section>
  </main>
</div>
